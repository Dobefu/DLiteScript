{{- define "main" -}}
  <h1>{{- .Title -}}</h1>

  {{- .Content -}}

  <div class="playground">
    <div class="playground__actions">
      <select class="playground__preset">
        <option value="custom">Custom</option>
      </select>
      <button class="playground__run-btn" disabled>Run code</button>
    </div>

    <div class="playground__container">
      <textarea class="playground__textarea"></textarea>
      <div class="playground__run-indicator"></div>
      <div class="playground__output"></div>
    </div>
  </div>

  {{- $worker_opts := dict
    "minify" (not hugo.IsDevelopment)
    "sourceMap" (cond hugo.IsDevelopment "external" "")
    "targetPath" "js/playground-worker.js"
    "format" "cjs"
  -}}

  {{- $wasm_path := resources.Get "/playground/DLiteScript-playground-wasm" -}}
  {{- $worker_path := resources.Match "playground/js/worker/*.js" | resources.Concat "js/playground-worker.js" | js.Build $worker_opts | fingerprint -}}

  {{- if not $wasm_path -}}
    {{- errorf "WASM file not found: /playground/DLiteScript-playground-wasm. Please build it first by running `./scripts/build-wasm.sh`." -}}
  {{- end -}}

  <script>
    globalThis.playgroundWasmPath = "{{- $wasm_path.RelPermalink -}}"
    globalThis.playgroundWorkerPath = "{{- $worker_path.RelPermalink -}}"
  </script>

  {{- $script_opts := dict
    "minify" (not hugo.IsDevelopment)
    "sourceMap" (cond hugo.IsDevelopment "external" "")
    "targetPath" "js/playground.js"
    "format" "cjs"
  -}}

  {{- with (resources.Match "playground/js/*.js") | resources.Concat "js/playground.js" -}}
    {{- with . | js.Build $script_opts -}}
      {{- if hugo.IsDevelopment -}}
        <script defer src="{{- .RelPermalink -}}" type="module"></script>
      {{- else -}}
        {{- with . | fingerprint -}}
          <script
            crossorigin="anonymous"
            defer
            integrity="{{- .Data.Integrity -}}"
            src="{{- .RelPermalink -}}"
            type="module"
          ></script>
        {{- end -}}
      {{- end -}}
    {{- end -}}
  {{- end -}}
{{- end -}}
