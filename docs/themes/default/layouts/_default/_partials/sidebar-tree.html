{{- $node := .node -}}
{{- $current := .current -}}

{{- range $child := $node.Sections.ByWeight -}}
  <li>
    {{- if or ($child.Sections) ($child.Pages) -}}
      {{- $isCurrentSection := eq $child.RelPermalink $current.RelPermalink -}}
      {{- $hasCurrentPage := or $isCurrentSection (hasPrefix $current.RelPermalink $child.RelPermalink) -}}

      <details class="sidebar__section"{{ if $hasCurrentPage }} open{{ end }}>
        <summary class="sidebar__section--header">
          <a href="{{ $child.Permalink }}">
            {{- $child.LinkTitle | default $child.Title -}}
          </a>
        </summary>

        <ul class="sidebar__section--pages">
          {{- partial "sidebar-tree.html" (dict "node" $child "current" $current) -}}
        </ul>
      </details>
    {{- else -}}
      <a class="sidebar__section--header" href="{{ $child.Permalink }}">
        {{- $child.LinkTitle | default $child.Title -}}
      </a>
    {{- end -}}
  </li>
{{- end -}}

{{- range $page := $node.Pages.ByWeight -}}
  {{- if not $page.IsSection -}}
    {{- $isActive := eq $page.RelPermalink $current.RelPermalink -}}

    <li>
      <a
        class="sidebar__link{{ if $isActive }} is-active{{ end }}"
        href="{{ $page.Permalink }}"
      >
        {{- $page.LinkTitle | default $page.Title -}}
      </a>
    </li>
  {{- end -}}
{{- end -}}


